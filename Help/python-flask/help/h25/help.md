# Заняття 25

## SQLAlchemy 

#### Частина 2 (Робота з базою даних)  

---

#### Додавання даних
Щоб додати новий запис в базу даних, необхідно створити об'єкт 
відповідної моделі, додати його до сесії і зберегти.

```python
# Створення нового користувача
new_user = User(username='Михайло', email='michael@example.com')

# Додавання користувача до сесії
db.session.add(new_user)

# Збереження змін у базі даних
db.session.commit()
```

#### Пошук
Flask-SQLAlchemy дозволяє виконувати запити до бази даних за допомогою методів моделей.

- **Отримання всіх записів:**
   ```python
   users = User.query.all()
   ```

- **Отримання одного запису за умовою:**
   ```python
   user = User.query.filter_by(username='Васильович').first()
   ```

- **Отримання запису за `id`:**
   ```python
   user = User.query.get(1)  # отримати користувача з id=1
   ```

- **Фільтрування за кількома умовами:**
   ```python
   users = User.query.filter(User.email.endswith('@example.com')).all()
   ```

#### Оновлення даних

Щоб оновити існуючий запис, потрібно знайти його, змінити необхідні 
поля і зберегти зміни в базі даних.

```python
user = User.query.get(1)  # отримати користувача з id=1
user.email = 'michael_teacher@example.com'

# Збереження змін
db.session.commit()
```

#### Видалення записів

Щоб видалити запис, потрібно знайти його, додати до сесії на видалення і виконати збереження.

```python
user = User.query.get(1)

# Видалення користувача
db.session.delete(user)

# Збереження змін
db.session.commit()
```

#### Пошук з використанням `like`

SQLAlchemy дозволяє виконувати складні запити, зокрема, 
з використанням `like` для пошуку за шаблоном.

```python
users = User.query.filter(User.username.like('%ан%')).all()
```

#### Сортування результатів

Щоб сортувати результати запитів, використовуйте `order_by`.

```python
users = User.query.order_by(User.username.desc()).all()
```

#### Лімітування та пагінація

SQLAlchemy дозволяє лімітувати кількість отриманих записів за допомогою методу `limit`.

```python
users = User.query.limit(10).all()  # Отримати перші 10 записів
```

#### Очищення бази даних

Щоб очистити всі таблиці в базі даних, використовуйте:

```python
db.drop_all()
```

#### Функції запитів

- `filter_by`: Фільтрує результати за точним співпадінням.
- `filter`: Фільтрує результати за більш складними умовами.
- `order_by`: Сортує результати.
- `limit`: Обмежує кількість повернутих результатів.
- `offset`: Пропускає певну кількість результатів.

```python
# Знайти всіх активних користувачів, відсортованих за датою створення
active_users = User.query.filter_by(is_active=True).order_by(User.created_at.desc()).all()
```
