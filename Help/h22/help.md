# Заняття 22

## Jinja2 

---

#### Основні принципи написання HTML-коду з Jinja2

Jinja2 — це потужний шаблонізатор для Python, який використовується у Flask для генерації динамічного HTML. Шаблони Jinja2 дозволяють додавати логіку до HTML, повторювати елементи, працювати зі змінними та здійснювати умовне рендерування контенту.

### Структура HTML-шаблону

Шаблон з використанням Jinja2 має структуру звичайного HTML-документа. Єдине, що додається — це логіка на основі Jinja.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title> <!-- Змінна Jinja -->
</head>
<body>
    <h1>Ласкаво просимо, {{ username }}!</h1> <!-- Виведення змінної -->
    <p>{{ description }}</p>
</body>
</html>
 
```

### Виведення змінних

Для виведення змінної використовуйте подвійні фігурні дужки: {{ змінна }}.

Якщо змінна не визначена, Jinja виведе порожній рядок (за замовчуванням).

```html
<p>Привіт, {{ user.name }}!</p> 
```

### Умовні конструкції

Використовуйте директиву {% if ... %} для умовного рендерування контенту.

```html
{% if logged_in %}
    <p>Привіт, {{ username }}! Ви ввійшли в систему.</p>
{% else %}
    <p>Ви не ввійшли в систему.</p>
{% endif %}
 
```

### Цикли

Для перебору списків або інших ітераційних об’єктів використовуйте цикл {% for ... %}.

```html
<ul>
    {% for item in items %}
        <li>{{ item.name }}</li>
    {% endfor %}
</ul>

```

###  Блоки та розширення шаблонів

Jinja2 підтримує концепцію наступних шаблонів (extends). Це дозволяє створювати базовий шаблон і розширювати його в інших файлах. Використовуйте {% block ... %} для визначення частин, які можна перевизначити у дочірніх шаблонах.

Базовий шаблон:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Мій Сайт{% endblock %}</title>
</head>
<body>
    <header>
        <h1>{% block header %}Заголовок{% endblock %}</h1>
    </header>
    <main>
        {% block content %}{% endblock %}
    </main>
</body>
</html>
```

Дочірній шаблон:

```html
{% extends "base.html" %}

{% block title %}Домашня Сторінка{% endblock %}

{% block header %}Вітаємо на домашній сторінці{% endblock %}

{% block content %}
    <p>Це головний контент сторінки.</p>
{% endblock %}

```

### Фільтри

Jinja2 автоматично екранує змінні для уникнення XSS-атак. Якщо потрібно вивести змінну без екранування, використовуйте фільтр |safe.

```html
<p>{{ html_content|safe }}</p> <!-- html_content буде виведено як HTML -->
```

Основні фільтри для екранування:

- safe: Позначає, що значення вже було екрановано і його не потрібно екранувати повторно. Використовується, коли ви впевнені, що дані не містять шкідливого коду.
- escape: Екранує всі спеціальні HTML символи, такі як <, >, &, ', ", щоб запобігти XSS-атакам. Це за замовчуванням для всіх виразів у шаблоні.
- urlencode: Кодує URL-адреси, замінюючи спеціальні символи на їхні кодовані еквіваленти.
- json_encode: Кодує дані у формат JSON.

Додаткові фільтри для форматування:

- capitalize: Переводить перший символ рядка у верхній регістр.
- lower: Переводить весь рядок у нижній регістр.
- upper: Переводить весь рядок у верхній регістр.
- title: Переводить кожне слово в рядку з великої літери.
- trim: Видаляє пробіли з початку і кінця рядка.
- striptags: Видаляє всі HTML-теги з рядка.

### Коментарі

Щоб залишити коментар, використовуйте {# ... #}. Цей коментар не буде виведено у фінальний HTML.

```html
{# Це коментар, його не буде видно в результаті #}
```

---

### Що слід памятати

Розділення шаблонів на частини
- Створюйте базові шаблони для спільних частин (шапка, підвал) і розширюйте їх у різних сторінках.

Уникнення надмірної логіки в шаблонах
- Уникайте складної логіки в Jinja-шаблонах. Краще виконувати логіку у Python-коді і передавати результат у шаблон.

Використовуйте макроси для повторюваних елементів
- Якщо у вас є повторювані елементи (наприклад, поля форм), використовуйте макроси для уникнення дублювання коду.

Використання фільтрів
- Завжди застосовуйте необхідні фільтри для форматування виведення (наприклад, |date, |join, |escape).


### Приклад використання Jinja2 у Flask

1. Передача змінних у шаблон

main.py:

```python
from flask import Flask, render_template

app = Flask(__name__)

@app.route('/')
def index():
    user = {'username': 'Олексій'}
    return render_template('index.html', title='Головна сторінка', user=user)

if __name__ == '__main__':
    app.run()
```

index.html:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
</head>
<body>
    <h1>Привіт, {{ user.username }}!</h1>
</body>
</html>
```

2. Використання циклів та умов

 main.py
 
```python
# ...

@app.route('/items')
def items():
    items = ['Книга', 'Ноутбук', 'Смартфон']
    return render_template('items.html', items=items)
```

items.html

```html
<ul>
    {% for item in items %}
        <li>{{ item }}</li>
    {% else %}
        <li>Немає доступних елементів</li>
    {% endfor %}
</ul>
```